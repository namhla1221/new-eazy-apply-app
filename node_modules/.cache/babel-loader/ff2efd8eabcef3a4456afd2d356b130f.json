{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _microApiClient = _interopRequireWildcard(require(\"micro-api-client\"));\n\nvar _admin = _interopRequireDefault(require(\"./admin.js\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar ExpiryMargin = 60 * 1000;\nvar storageKey = 'gotrue.user';\nvar refreshPromises = {};\nvar currentUser = null;\nvar forbiddenUpdateAttributes = {\n  api: 1,\n  token: 1,\n  audience: 1,\n  url: 1\n};\nvar forbiddenSaveAttributes = {\n  api: 1\n};\n\nvar isBrowser = function isBrowser() {\n  return typeof window !== 'undefined';\n};\n\nvar User = /*#__PURE__*/function () {\n  function User(api, tokenResponse, audience) {\n    _classCallCheck(this, User);\n\n    this.api = api;\n    this.url = api.apiURL;\n    this.audience = audience;\n\n    this._processTokenResponse(tokenResponse);\n\n    currentUser = this;\n  }\n\n  _createClass(User, [{\n    key: \"update\",\n    value: function update(attributes) {\n      var _this = this;\n\n      return this._request('/user', {\n        method: 'PUT',\n        body: JSON.stringify(attributes)\n      }).then(function (response) {\n        return _this._saveUserData(response)._refreshSavedSession();\n      });\n    }\n  }, {\n    key: \"jwt\",\n    value: function jwt(forceRefresh) {\n      var token = this.tokenDetails();\n\n      if (token === null || token === undefined) {\n        return Promise.reject(new Error(\"Gotrue-js: failed getting jwt access token\"));\n      }\n\n      var expires_at = token.expires_at,\n          refresh_token = token.refresh_token,\n          access_token = token.access_token;\n\n      if (forceRefresh || expires_at - ExpiryMargin < Date.now()) {\n        return this._refreshToken(refresh_token);\n      }\n\n      return Promise.resolve(access_token);\n    }\n  }, {\n    key: \"logout\",\n    value: function logout() {\n      return this._request('/logout', {\n        method: 'POST'\n      }).then(this.clearSession.bind(this))[\"catch\"](this.clearSession.bind(this));\n    }\n  }, {\n    key: \"_refreshToken\",\n    value: function _refreshToken(refresh_token) {\n      var _this2 = this;\n\n      if (refreshPromises[refresh_token]) {\n        return refreshPromises[refresh_token];\n      }\n\n      return refreshPromises[refresh_token] = this.api.request('/token', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: \"grant_type=refresh_token&refresh_token=\".concat(refresh_token)\n      }).then(function (response) {\n        delete refreshPromises[refresh_token];\n\n        _this2._processTokenResponse(response);\n\n        _this2._refreshSavedSession();\n\n        return _this2.token.access_token;\n      })[\"catch\"](function (error) {\n        delete refreshPromises[refresh_token];\n\n        _this2.clearSession();\n\n        return Promise.reject(error);\n      });\n    }\n  }, {\n    key: \"_request\",\n    value: function _request(path) {\n      var _this3 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      options.headers = options.headers || {};\n      var aud = options.audience || this.audience;\n\n      if (aud) {\n        options.headers['X-JWT-AUD'] = aud;\n      }\n\n      return this.jwt().then(function (token) {\n        return _this3.api.request(path, _objectSpread({\n          headers: Object.assign(options.headers, {\n            Authorization: \"Bearer \".concat(token)\n          })\n        }, options))[\"catch\"](function (error) {\n          if (error instanceof _microApiClient.JSONHTTPError && error.json) {\n            if (error.json.msg) {\n              error.message = error.json.msg;\n            } else if (error.json.error) {\n              error.message = \"\".concat(error.json.error, \": \").concat(error.json.error_description);\n            }\n          }\n\n          return Promise.reject(error);\n        });\n      });\n    }\n  }, {\n    key: \"getUserData\",\n    value: function getUserData() {\n      return this._request('/user').then(this._saveUserData.bind(this)).then(this._refreshSavedSession.bind(this));\n    }\n  }, {\n    key: \"_saveUserData\",\n    value: function _saveUserData(attributes, fromStorage) {\n      for (var key in attributes) {\n        if (key in User.prototype || key in forbiddenUpdateAttributes) {\n          continue;\n        }\n\n        this[key] = attributes[key];\n      }\n\n      if (fromStorage) {\n        this._fromStorage = true;\n      }\n\n      return this;\n    }\n  }, {\n    key: \"_processTokenResponse\",\n    value: function _processTokenResponse(tokenResponse) {\n      this.token = tokenResponse;\n\n      try {\n        var claims = JSON.parse(urlBase64Decode(tokenResponse.access_token.split('.')[1]));\n        this.token.expires_at = claims.exp * 1000;\n      } catch (error) {\n        console.error(new Error(\"Gotrue-js: Failed to parse tokenResponse claims: \".concat(error)));\n      }\n    }\n  }, {\n    key: \"_refreshSavedSession\",\n    value: function _refreshSavedSession() {\n      // only update saved session if we previously saved something\n      if (isBrowser() && localStorage.getItem(storageKey)) {\n        this._saveSession();\n      }\n\n      return this;\n    }\n  }, {\n    key: \"_saveSession\",\n    value: function _saveSession() {\n      isBrowser() && localStorage.setItem(storageKey, JSON.stringify(this._details));\n      return this;\n    }\n  }, {\n    key: \"tokenDetails\",\n    value: function tokenDetails() {\n      return this.token;\n    }\n  }, {\n    key: \"clearSession\",\n    value: function clearSession() {\n      User.removeSavedSession();\n      this.token = null;\n      currentUser = null;\n    }\n  }, {\n    key: \"admin\",\n    get: function get() {\n      return new _admin[\"default\"](this);\n    }\n  }, {\n    key: \"_details\",\n    get: function get() {\n      var userCopy = {};\n\n      for (var key in this) {\n        if (key in User.prototype || key in forbiddenSaveAttributes) {\n          continue;\n        }\n\n        userCopy[key] = this[key];\n      }\n\n      return userCopy;\n    }\n  }], [{\n    key: \"removeSavedSession\",\n    value: function removeSavedSession() {\n      isBrowser() && localStorage.removeItem(storageKey);\n    }\n  }, {\n    key: \"recoverSession\",\n    value: function recoverSession(apiInstance) {\n      if (currentUser) {\n        return currentUser;\n      }\n\n      var json = isBrowser() && localStorage.getItem(storageKey);\n\n      if (json) {\n        try {\n          var data = JSON.parse(json);\n          var url = data.url,\n              token = data.token,\n              audience = data.audience;\n\n          if (!url || !token) {\n            return null;\n          }\n\n          var api = apiInstance || new _microApiClient[\"default\"](url, {});\n          return new User(api, token, audience)._saveUserData(data, true);\n        } catch (error) {\n          console.error(new Error(\"Gotrue-js: Error recovering session: \".concat(error)));\n          return null;\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return User;\n}();\n\nexports[\"default\"] = User;\n\nfunction urlBase64Decode(str) {\n  // From https://jwt.io/js/jwt.js\n  var output = str.replace(/-/g, '+').replace(/_/g, '/');\n\n  switch (output.length % 4) {\n    case 0:\n      break;\n\n    case 2:\n      output += '==';\n      break;\n\n    case 3:\n      output += '=';\n      break;\n\n    default:\n      throw 'Illegal base64url string!';\n  } // polifyll https://github.com/davidchambers/Base64.js\n\n\n  var result = window.atob(output);\n\n  try {\n    return decodeURIComponent(escape(result));\n  } catch (error) {\n    return result;\n  }\n}","map":{"version":3,"sources":["/home/namhla/projects/New-Eazy-Apply/node_modules/gotrue-js/lib/user.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","Object","defineProperty","exports","value","_microApiClient","_interopRequireWildcard","require","_admin","_interopRequireDefault","__esModule","_getRequireWildcardCache","WeakMap","cache","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","ExpiryMargin","storageKey","refreshPromises","currentUser","forbiddenUpdateAttributes","api","token","audience","url","forbiddenSaveAttributes","isBrowser","window","User","tokenResponse","apiURL","_processTokenResponse","update","attributes","_this","_request","method","body","JSON","stringify","then","response","_saveUserData","_refreshSavedSession","jwt","forceRefresh","tokenDetails","undefined","Promise","reject","Error","expires_at","refresh_token","access_token","Date","now","_refreshToken","resolve","logout","clearSession","bind","_this2","request","headers","concat","error","path","_this3","options","aud","assign","Authorization","JSONHTTPError","json","msg","message","error_description","getUserData","fromStorage","_fromStorage","claims","parse","urlBase64Decode","split","exp","console","localStorage","getItem","_saveSession","setItem","_details","removeSavedSession","userCopy","removeItem","recoverSession","apiInstance","data","str","output","replace","result","atob","decodeURIComponent","escape"],"mappings":"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","sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _microApiClient = _interopRequireWildcard(require(\"micro-api-client\"));\n\nvar _admin = _interopRequireDefault(require(\"./admin.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar ExpiryMargin = 60 * 1000;\nvar storageKey = 'gotrue.user';\nvar refreshPromises = {};\nvar currentUser = null;\nvar forbiddenUpdateAttributes = {\n  api: 1,\n  token: 1,\n  audience: 1,\n  url: 1\n};\nvar forbiddenSaveAttributes = {\n  api: 1\n};\n\nvar isBrowser = function isBrowser() {\n  return typeof window !== 'undefined';\n};\n\nvar User = /*#__PURE__*/function () {\n  function User(api, tokenResponse, audience) {\n    _classCallCheck(this, User);\n\n    this.api = api;\n    this.url = api.apiURL;\n    this.audience = audience;\n\n    this._processTokenResponse(tokenResponse);\n\n    currentUser = this;\n  }\n\n  _createClass(User, [{\n    key: \"update\",\n    value: function update(attributes) {\n      var _this = this;\n\n      return this._request('/user', {\n        method: 'PUT',\n        body: JSON.stringify(attributes)\n      }).then(function (response) {\n        return _this._saveUserData(response)._refreshSavedSession();\n      });\n    }\n  }, {\n    key: \"jwt\",\n    value: function jwt(forceRefresh) {\n      var token = this.tokenDetails();\n\n      if (token === null || token === undefined) {\n        return Promise.reject(new Error(\"Gotrue-js: failed getting jwt access token\"));\n      }\n\n      var expires_at = token.expires_at,\n          refresh_token = token.refresh_token,\n          access_token = token.access_token;\n\n      if (forceRefresh || expires_at - ExpiryMargin < Date.now()) {\n        return this._refreshToken(refresh_token);\n      }\n\n      return Promise.resolve(access_token);\n    }\n  }, {\n    key: \"logout\",\n    value: function logout() {\n      return this._request('/logout', {\n        method: 'POST'\n      }).then(this.clearSession.bind(this))[\"catch\"](this.clearSession.bind(this));\n    }\n  }, {\n    key: \"_refreshToken\",\n    value: function _refreshToken(refresh_token) {\n      var _this2 = this;\n\n      if (refreshPromises[refresh_token]) {\n        return refreshPromises[refresh_token];\n      }\n\n      return refreshPromises[refresh_token] = this.api.request('/token', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: \"grant_type=refresh_token&refresh_token=\".concat(refresh_token)\n      }).then(function (response) {\n        delete refreshPromises[refresh_token];\n\n        _this2._processTokenResponse(response);\n\n        _this2._refreshSavedSession();\n\n        return _this2.token.access_token;\n      })[\"catch\"](function (error) {\n        delete refreshPromises[refresh_token];\n\n        _this2.clearSession();\n\n        return Promise.reject(error);\n      });\n    }\n  }, {\n    key: \"_request\",\n    value: function _request(path) {\n      var _this3 = this;\n\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      options.headers = options.headers || {};\n      var aud = options.audience || this.audience;\n\n      if (aud) {\n        options.headers['X-JWT-AUD'] = aud;\n      }\n\n      return this.jwt().then(function (token) {\n        return _this3.api.request(path, _objectSpread({\n          headers: Object.assign(options.headers, {\n            Authorization: \"Bearer \".concat(token)\n          })\n        }, options))[\"catch\"](function (error) {\n          if (error instanceof _microApiClient.JSONHTTPError && error.json) {\n            if (error.json.msg) {\n              error.message = error.json.msg;\n            } else if (error.json.error) {\n              error.message = \"\".concat(error.json.error, \": \").concat(error.json.error_description);\n            }\n          }\n\n          return Promise.reject(error);\n        });\n      });\n    }\n  }, {\n    key: \"getUserData\",\n    value: function getUserData() {\n      return this._request('/user').then(this._saveUserData.bind(this)).then(this._refreshSavedSession.bind(this));\n    }\n  }, {\n    key: \"_saveUserData\",\n    value: function _saveUserData(attributes, fromStorage) {\n      for (var key in attributes) {\n        if (key in User.prototype || key in forbiddenUpdateAttributes) {\n          continue;\n        }\n\n        this[key] = attributes[key];\n      }\n\n      if (fromStorage) {\n        this._fromStorage = true;\n      }\n\n      return this;\n    }\n  }, {\n    key: \"_processTokenResponse\",\n    value: function _processTokenResponse(tokenResponse) {\n      this.token = tokenResponse;\n\n      try {\n        var claims = JSON.parse(urlBase64Decode(tokenResponse.access_token.split('.')[1]));\n        this.token.expires_at = claims.exp * 1000;\n      } catch (error) {\n        console.error(new Error(\"Gotrue-js: Failed to parse tokenResponse claims: \".concat(error)));\n      }\n    }\n  }, {\n    key: \"_refreshSavedSession\",\n    value: function _refreshSavedSession() {\n      // only update saved session if we previously saved something\n      if (isBrowser() && localStorage.getItem(storageKey)) {\n        this._saveSession();\n      }\n\n      return this;\n    }\n  }, {\n    key: \"_saveSession\",\n    value: function _saveSession() {\n      isBrowser() && localStorage.setItem(storageKey, JSON.stringify(this._details));\n      return this;\n    }\n  }, {\n    key: \"tokenDetails\",\n    value: function tokenDetails() {\n      return this.token;\n    }\n  }, {\n    key: \"clearSession\",\n    value: function clearSession() {\n      User.removeSavedSession();\n      this.token = null;\n      currentUser = null;\n    }\n  }, {\n    key: \"admin\",\n    get: function get() {\n      return new _admin[\"default\"](this);\n    }\n  }, {\n    key: \"_details\",\n    get: function get() {\n      var userCopy = {};\n\n      for (var key in this) {\n        if (key in User.prototype || key in forbiddenSaveAttributes) {\n          continue;\n        }\n\n        userCopy[key] = this[key];\n      }\n\n      return userCopy;\n    }\n  }], [{\n    key: \"removeSavedSession\",\n    value: function removeSavedSession() {\n      isBrowser() && localStorage.removeItem(storageKey);\n    }\n  }, {\n    key: \"recoverSession\",\n    value: function recoverSession(apiInstance) {\n      if (currentUser) {\n        return currentUser;\n      }\n\n      var json = isBrowser() && localStorage.getItem(storageKey);\n\n      if (json) {\n        try {\n          var data = JSON.parse(json);\n          var url = data.url,\n              token = data.token,\n              audience = data.audience;\n\n          if (!url || !token) {\n            return null;\n          }\n\n          var api = apiInstance || new _microApiClient[\"default\"](url, {});\n          return new User(api, token, audience)._saveUserData(data, true);\n        } catch (error) {\n          console.error(new Error(\"Gotrue-js: Error recovering session: \".concat(error)));\n          return null;\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return User;\n}();\n\nexports[\"default\"] = User;\n\nfunction urlBase64Decode(str) {\n  // From https://jwt.io/js/jwt.js\n  var output = str.replace(/-/g, '+').replace(/_/g, '/');\n\n  switch (output.length % 4) {\n    case 0:\n      break;\n\n    case 2:\n      output += '==';\n      break;\n\n    case 3:\n      output += '=';\n      break;\n\n    default:\n      throw 'Illegal base64url string!';\n  } // polifyll https://github.com/davidchambers/Base64.js\n\n\n  var result = window.atob(output);\n\n  try {\n    return decodeURIComponent(escape(result));\n  } catch (error) {\n    return result;\n  }\n}"]},"metadata":{},"sourceType":"script"}